<style>
    .browser-deleted-page {
        display: none;
        margin-right: 2%;
    }

    /* page toolbar */
    .browser-deleted-page .top-toolbar {
        margin-top: 20px;
        margin-left: 20px;
    }

    .top-toolbar-search {
        background-color: rgba(223, 223, 223, 0.555);
        width: 600px;
        padding: 13px;
        font-size: small;
        border: none;
        outline: none;
        color: gray;
        border-radius: 4px;
    }

    /* categorizer */
    .deleted-categorizer {
        margin-top: 20px;
        padding-left: 20px;
        padding-top: 10px;
        padding-bottom: 10px;
        display: grid;
        grid-template-columns: 40% 20% 15% 15%;
        border-bottom: solid 1px rgba(235, 235, 235, 0.685);
    }

    /* deleted file item */
    .deleted-file-item {
        padding-left: 20px;
        padding-top: 10px;
        padding-bottom: 10px;
        display: grid;
        grid-template-columns: 40% 20% 15% 15%;
        border-bottom: solid 1px rgba(235, 235, 235, 0.685);
        transition: all 0.1s ease;
    }


</style>

<div class="browser-deleted-page">
    <div class="top-toolbar">
        <form autocomplete="off" method="dialog">
            <input id="deletedFileSearchInput" onkeyup="searchDeletedFile(event)" class="top-toolbar-search" placeholder="Search for deleted file" type="search">
        </form>
    </div>

    <!-- categorizer -->
    <div class="deleted-categorizer">
        <div class="categorizer-text">Identification</div>
        <div class="categorizer-text">Name</div>
        <div class="categorizer-text hide-mobile ">Deleted-by</div>
        <div class="categorizer-text hide-mobile ">Deleted</div>
    </div>


    <!-- loader -->
    <div id="deletedFilesLoader" class="pageLoader" style="transform: scale(0.2);">
        <div class="loader-console"></div>
   </div>

    <!-- deleted items -->
    <div id="bodyDeletedFiles" class="deleted-files-list">

    </div>

</div>

<script>
    var deletedPageBrowser 
    let deletedObjectArray 

    
    //classes 
    let deletedFile = class {
        constructor(jsonObject){
            this.id = jsonObject["fileID"]
            this.name = jsonObject["name"]
            this.deleted_by = jsonObject["deletedBy"]
            this.deleted = jsonObject["deleted"]
            this.trimedID = jsonObject["fileID"]

            //trim name 
            this.trimName()
            this.trimID()
            this.convertDate()
        }

        trimName(){
            if (this.name.length > 25){
                this.name =  this.name.substring(0, 25) + "..."
            }
        }

        trimID(){
           this.trimedID = this.id.substring(0, 25) + "..." + this.id.substring(46, 64)
        }

        convertDate(){
            this.date = new Date(this.deleted);
            this.date = (this.date.getDate() + "-" + this.date.getMonth() + "-" + this.date.getFullYear() + " " + 
                this.date.getHours()+":"+this.date.getMinutes()); 
        }

        
    }


    window.addEventListener("DOMContentLoaded",()=>{
        deletedPageBrowser = document.querySelector(".browser-deleted-page")
    })

    function showBrowserDeletedPage(){
        deletedPageBrowser.style.display = "block"

        //start loading
        setDeletedFilesLoading();

        //get deleted files
        getDeletedFiles()
    }

    function setDeletedFilesLoading(){
        var loadingObject = document.getElementById("deletedFilesLoader")
        if (!loadingObject.classList.contains("show")){
            loadingObject.classList.add("show")
        }
    }


    function cancelDeletedFilesLoading(){
        var loadingObject = document.getElementById("deletedFilesLoader")
        loadingObject.classList.remove("show")
    }

    function hideBrowserDeletedPage(){
        deletedPageBrowser .style.display = "none"
    }

    function searchDeletedFile(event){
        if (document.getElementById("deletedFileSearchInput").value == ""){
            getDeletedFiles()
            return
        }
        if (event.keyCode === 13) {
            var bodyToShow = document.getElementById("bodyDeletedFiles")
        
            //data 
            data = {
                "project" : localStorage.getItem("working-project"),
                "criteria" : document.getElementById("deletedFileSearchInput").value
            }

            postToServer("/api/search-deleted-files/", data, function(responce) {
                deletedObjectArray = JSON.parse(responce)

                //clear body 
                bodyToShow.innerHTML = ""

                //iterate objects
                deletedObjectArray.forEach(element => {
                    //new deleted file object
                    var newDeletedFile = new deletedFile(element)

                    //frame to add to UI
                    var frame = `
                    <div class="deleted-file-item">
                        <div class="categorizer-text">${newDeletedFile.trimedID}</div>
                        <div class="categorizer-text">${newDeletedFile.name}</div>
                        <div class="categorizer-text hide-mobile ">${newDeletedFile.deleted_by}</div>
                        <div class="categorizer-text hide-mobile ">${newDeletedFile.date}</div>
                    </div>
                    `

                    //add to UI
                    bodyToShow.innerHTML += frame ;
                });
            })
        }

    }

    function getDeletedFiles(){
        var bodyToShow = document.getElementById("bodyDeletedFiles")
        //get objects from the server 
        data = {
            "project" : localStorage.getItem("working-project")
        }
        postToServer("/api/get-deleted-files/", data, function(responce) {
            //cancel loading
            cancelDeletedFilesLoading()

            if (responce == "500" || responce == "not found" || responce == "denied"){
                ShowWarning("Fetch Objects Failed")
            }
            else{

                deletedObjectArray = JSON.parse(responce)

                //clear body 
                bodyToShow.innerHTML = ""

                //iterate objects
                deletedObjectArray.forEach(element => {
                    //new deleted file object
                    var newDeletedFile = new deletedFile(element)

                    //frame to add to UI
                    var frame = `
                    <div class="deleted-file-item">
                        <div class="categorizer-text">${newDeletedFile.trimedID}</div>
                        <div class="categorizer-text">${newDeletedFile.name}</div>
                        <div class="categorizer-text hide-mobile ">${newDeletedFile.deleted_by}</div>
                        <div class="categorizer-text hide-mobile ">${newDeletedFile.date}</div>
                    </div>
                    `

                    //add to UI
                    bodyToShow.innerHTML += frame ;
                });
            }
        })

    }


</script>