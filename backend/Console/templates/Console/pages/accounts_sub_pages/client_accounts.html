<style>
    .client-accounts {
        display: none;
    }


    .accounts-clients-page {
        margin-right: 2%;
    }

    /* page toolbar */
    .accounts-clients-page .top-toolbar {
        margin-top: 20px;
        margin-left: 20px;
    }

    .top-toolbar {
        display: flex;
        justify-content: start;
        align-items: center;
    }

    .top-toolbar-search {
        background-color: rgba(223, 223, 223, 0.555);
        width: 600px;
        padding: 13px;
        margin-left: 20px;
        font-size: small;
        border: none;
        outline: none;
        color: gray;
        border-radius: 4px;
    }

    .add-client-account {
        margin-left: auto;
        margin-right: 40px;
        color: gray;
    }

    /* categorizer */
    .clients-categorizer {
        margin-top: 20px;
        padding-left: 20px;
        padding-top: 10px;
        padding-bottom: 10px;
        display: grid;
        grid-template-columns: 25%  15% 15% 30% 15%;
        border-bottom: solid 1px rgba(235, 235, 235, 0.685);
    }

    /* clients file item */
    .client-item {
        padding-left: 20px;
        padding-top: 10px;
        padding-bottom: 10px;
        display: grid;
        grid-template-columns: 25%  15% 15% 30% 15%;
        border-bottom: solid 1px rgba(235, 235, 235, 0.685);
        transition: all 0.1s ease;
    }

    select {
        -webkit-appearance: none;
        -moz-appearance: none;
        border: none;
        margin-right: 10px;
        background-position: 98% 50%;
        background-size: 12px;
        background-repeat: no-repeat;
    }


    .controls-client-accounts {
        display: grid;
        padding-right: 10px;
        grid-template-columns: 30px 30px 30px;
    }

    
    @media only screen and (max-width: 600px) {
    .clients-file-item{
        grid-template-columns: 100%;
    }

    .top-toolbar-search {
        width: auto;
        margin-right: 5px;
    }
    }



</style>

<!-- add client account modal -extends folder modal  -->
<div id="addClientAccount" class="console-modal">
    <form method="dialog" autocomplete="off">
        <!-- cancel  modal-->
        <div class="modal-cancel">
            <i class="fas fa-times" onclick="hideAddClientModal()"></i>
        </div>

        <div class="console-modal-subtext" style="font-size: small; margin-top: 20px;">Intergration</div>
        
        <div  class="input-frame" style="position: relative;">
            <select id="addClientIntegrations" class="projects-modal-body-item plain-input no-anime" style="width: 302px; padding-right: 5px; cursor: text; font-size: small;">
                <!-- integrations come here -->
                
            </select>
        </div>
        <div class="console-modal-subtext" style="font-size: small;">Client Provider</div>
        <div  class="input-frame" style="position: relative;">
            <input class="projects-modal-body-item plain-input no-anime" style="width: 280px;cursor: text;font-size: small;">
        </div>
        <div class="folder-namer-buttons" style="margin-top: 5px;">
            <div  class="create-folder-button" style="font-size: small;"> 
                Add
            </div>
        </div>
    </form>
</div>



<div id="client-accounts" class="client-accounts">

    <div class="top-toolbar">
        <form autocomplete="off" method="dialog">
            <input class="top-toolbar-search" placeholder="Search for client" type="search">
        </form>
        <span class="add-client-account"><i class="fas fa-plus" onclick="showAddClientModal()"></i></span>
    </div>

    <!-- categorizer -->
    <div class="clients-categorizer">
        <div class="categorizer-text ">Identification</div>
        <div class="categorizer-text hide-mobile ">Created</div>
        <div class="categorizer-text hide-mobile ">Last login</div>
        <div class="categorizer-text hide-mobile ">Access Token</div>
        <div class="categorizer-text hide-mobile">Controls</div>
    </div>


    <!-- loader -->
    <div  class="pageLoader" style="transform: scale(0.2);">
        <div class="loader-console"></div>
   </div>

    <!-- clients items -->
    <div id="clients-accounts-list" class="clients-accounts-list">

    </div>
</div>

<script>
    
    //integration class 
    let Intergration = class {
        
        constructor(jsonObject){
            this.identifier = jsonObject["identifier"]
            this.enabled = jsonObject["enabled"]  
            this.created = ["created"]  
            this.integrationKey = ["integrationKey"] 
            this.platform = ["platform"]["name"] 
        }

    }

    //developer client class
    let DeveloperClient = class{
        constructor(developerClient){
            this.user = developerClient["user"]
            this.identification =  developerClient["identification"]
            this.date_joined =  developerClient["user"]["date_joined"]
            this.last_login =  developerClient["last_login"]
            this.token =  developerClient["token"]
            this.date_joined = convertDate(this.date_joined)
            this.last_login = convertDate(this.last_login)
        }
    }


    function getDeveloperClients(){
        //body to display
        bodyToDisplay = document.getElementById("clients-accounts-list")
        bodyToDisplay.innerHTML = ""

        data = {
            "project" : localStorage.getItem("working-project")
        }

        //requests
        postToServer("/console/developer-clients", data, function(responce) {
            if (responce == "not found" || responce == "Does'nt seem like the JSON we need"){
                ShowWarning("Error Fetching Objects")
            }
            else {
                //array
                developerClientsArray = JSON.parse(responce)

                developerClientsArray.forEach(developerClient => {
                    var developerClientNew = new DeveloperClient(developerClient)
                    frame = `
                    <div class="client-item">
                        <div class="categorizer-text">${developerClientNew.identification}</div>
                        <div class="categorizer-text hide-mobile ">${developerClientNew.date_joined}</div>
                        <div class="categorizer-text hide-mobile ">${developerClientNew.last_login}</div>
                        <div class="categorizer-text hide-mobile ">${developerClientNew.token}</div>
                        <div class="categorizer-text controls-client-accounts hide-mobile">
                                <div class="barn-client hide-mobile">
                                    <i class="fas fa-ban"></i>
                                </div>
                                <div class="delete-client hide-mobile">
                                    <i class="fas fa-edit"></i>         
                                </div>
                                <div class="edit-client hide-mobile">
                                    <i class="fas fa-trash"></i>
                                </div>
                            </div>
                        </div>
                    `
                    
                    bodyToDisplay.innerHTML += frame
                });
                
            }
        })

    }

    function showClientAccounts(){
        //page
        var pageClientAccounts = document.getElementById("client-accounts")

        //show
        pageClientAccounts.style.display = "grid"

        //get integrations
        getIntegrations()
        getDeveloperClients()
    }

    function hideClientAccounts(){
        //page
        var pageClientAccounts = document.getElementById("client-accounts")

        //show
        pageClientAccounts.style.display = "none"
    }

    function getIntegrations(){
        //body to display 
        var bodyToDisplay = document.getElementById("addClientIntegrations")
        bodyToDisplay.innerHTML = ""

        //data 
        data = {
            "project" : localStorage.getItem("working-project") 
        }

        //request
        postToServer("/console/integrations", data, function(responce) {
            if (responce == "not found" || responce == "Does'nt seem like the JSON we need"){
                ShowWarning("Error Fetching Objects")
            }
            else{
                //array
                IntegrationObjectList = JSON.parse(responce)

                IntegrationObjectList.forEach(jsonObject => {
                    intergration = new Intergration(jsonObject)
                    frame = `
                        <option value="${intergration.identifier}">${intergration.identifier}</option>
                    `

                    bodyToDisplay.innerHTML += frame ;
                });

            }
        })

    }

    function showAddClientModal(){
        var modal = document.getElementById("addClientAccount")
        if (!modal.classList.contains("show")){
            modal.classList.add("show")
        }

    }

    function hideAddClientModal(){
        var modal = document.getElementById("addClientAccount")
        modal.classList.remove("show")
    }




</script>
