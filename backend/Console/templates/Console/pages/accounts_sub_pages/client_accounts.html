<style>
    .client-accounts {
        display: none;
    }


    .accounts-clients-page {
        margin-right: 2%;
    }

    /* page toolbar */
    .accounts-clients-page .top-toolbar {
        margin-top: 20px;
        margin-left: 20px;
    }

    .top-toolbar {
        display: flex;
        justify-content: start;
        align-items: center;
    }

    .top-toolbar-search {
        background-color: rgba(223, 223, 223, 0.555);
        width: 600px;
        padding: 13px;
        margin-left: 20px;
        font-size: small;
        border: none;
        outline: none;
        color: gray;
        border-radius: 4px;
    }

    .add-client-account {
        margin-left: auto;
        margin-right: 40px;
        color: gray;
    }

    /* categorizer */
    .clients-categorizer {
        margin-top: 20px;
        padding-left: 20px;
        padding-top: 10px;
        padding-bottom: 10px;
        display: grid;
        grid-template-columns: 25%  15% 15% 30% 15%;
        border-bottom: solid 1px rgba(235, 235, 235, 0.685);
    }

    /* clients file item */
    .client-item {
        padding-left: 20px;
        padding-top: 10px;
        padding-bottom: 10px;
        display: grid;
        grid-template-columns: 25%  15% 15% 30% 15%;
        border-bottom: solid 1px rgba(235, 235, 235, 0.685);
        transition: all 0.1s ease;
    }

    select {
        -webkit-appearance: none;
        -moz-appearance: none;
        border: none;
        margin-right: 10px;
        background-position: 98% 50%;
        background-size: 12px;
        background-repeat: no-repeat;
    }


    .controls-client-accounts {
        display: grid;
        padding-right: 10px;
        grid-template-columns: 30px 30px 30px;
    }

    
    @media only screen and (max-width: 600px) {
    .clients-file-item{
        grid-template-columns: 100%;
    }

    .top-toolbar-search {
        width: auto;
        margin-right: 5px;
    }
    }

    .barned > div{
        color: rgba(255, 0, 0, 0.651) !important;
    }

</style>

<!-- add client account modal -extends folder modal  -->
<div id="addClientAccount" class="console-modal">
    <form method="dialog" autocomplete="off">
        <!-- cancel  modal-->
        <div class="modal-cancel">
            <i class="fas fa-times" onclick="hideAddClientModal()"></i>
        </div>

        <div class="console-modal-subtext" style="font-size: small; margin-top: 20px;">Intergration</div>
        
        <div  class="input-frame" style="position: relative;">
            <select id="addClientIntegrations" class="projects-modal-body-item plain-input no-anime" style="width: 302px; padding-right: 5px; cursor: text; font-size: small;">
                <!-- integrations come here -->
            </select>
        </div>
        <!-- client identification-->
        <div class="console-modal-subtext" style="font-size: small;">Client Provider</div>
        <div  class="input-frame" style="position: relative;">
            <input id="newClientAccountIdentification" placeholder="Identifier" class="projects-modal-body-item plain-input no-anime" style="width: 280px;cursor: text;font-size: small;">
        </div>
        <!-- client password-->
        <div class="console-modal-subtext" style="font-size: small;">Client Password</div>
        <div  class="input-frame" style="position: relative;">
            <form autocomplete="off" method="dialog">
                <input type="password" placeholder="Password" id="newClientPasswordinput" class="projects-modal-body-item plain-input no-anime" style="width: 280px;cursor: text;font-size: small;">
            </form>
        </div>
        <div class="folder-namer-buttons" style="margin-top: 5px;">
            <div onclick="addClientAccount()" class="create-folder-button" style="font-size: small;"> 
                Add
            </div>
        </div>
    </form>
</div>


<!--  edit client modal  -->
<div id="editClientAccountModal"  class="console-modal">
    <form method="dialog" autocomplete="off">
        <!-- cancel  modal-->
        <div class="modal-cancel">
            <i class="fas fa-times" onclick="hideEditClientModal()"></i>
        </div>

        <div class="console-modal-subtext" style="font-size: small; margin-top: 20px;">Intergration</div>
        
        <div  class="input-frame" style="position: relative;">
            <input id="updateClientIntegrations"  readonly class="projects-modal-body-item plain-input no-anime" placeholder="Integration" style="width: 302px; padding-right: 5px; cursor: text; font-size: small;">
        </div>

        <!-- client identification-->
        <div class="console-modal-subtext" style="font-size: small;">Client Provider</div>
        <div  class="input-frame" style="position: relative;">
            <input id="updateClientAccountIdentifierInput" readonly  placeholder="Identifier" class="projects-modal-body-item plain-input no-anime" style="width: 280px;cursor: text;font-size: small;">
        </div>
        <!-- client password-->
        <div class="console-modal-subtext" style="font-size: small;">Client Password</div>
        <div  class="input-frame" style="position: relative;">
            <form autocomplete="off" method="dialog">
                <input id="updateClientAccountPassword" placeholder="New Password" class="projects-modal-body-item plain-input no-anime" style="width: 280px;cursor: text;font-size: small;">
            </form>
        </div>
        <div class="folder-namer-buttons" style="margin-top: 5px;">
            <div onclick="updateClientHttpRequest()" class="create-folder-button" style="font-size: small;"> 
                Update Client
            </div>
        </div>
    </form>
</div>


<!-- barn account modal -->
<div id="barnClientAccountModal" class="console-modal">
    <form method="dialog" autocomplete="off">
        <!-- cancel  modal-->
        <div class="modal-cancel">
            <i class="fas fa-times" onclick="hideBarnAccountModal()"></i>
        </div>
        <div class="console-modal-subtext" style="font-size: small;">Barn Account</div>
        <div  class="input-frame" style="position: relative;">
            <input id="accountToBarnIdentificationSpan" readonly class="projects-modal-body-item plain-input no-anime" style="width: 280px;cursor: text;font-size: small;">
        </div>
        <div class="folder-namer-buttons" style="margin-top: 5px;">
            <div onclick="barnClientAccountHttpRequest()"  class="create-folder-button" style="font-size: small; background-color: rgba(53, 53, 53, 0.685);"> 
                Barn
            </div>
        </div>
    </form>
</div>



<!-- delete account modal -->
<div id="deleteClientAccountModal" class="console-modal">
    <form method="dialog" autocomplete="off">
        <!-- cancel  modal-->
        <div class="modal-cancel">
            <i class="fas fa-times" onclick="hideDeleteAccountModal()"></i>
        </div>
        <div class="console-modal-subtext" style="font-size: small;">Delete Account</div>
        <div  class="input-frame" style="position: relative;">
            <input id="deleteClientAccountIdentification" readonly class="projects-modal-body-item plain-input no-anime" style="width: 280px;cursor: text;font-size: small;">
        </div>
        <div class="folder-namer-buttons" style="margin-top: 5px;">
            <div onclick="deleteClientAccountHttpRequest()"  class="create-folder-button" style="font-size: small; background-color: rgba(228, 82, 82, 0.685);"> 
                Delete
            </div>
        </div>
    </form>
</div>



<div id="removeBarnClientAccountModal" class="console-modal">
    <form method="dialog" autocomplete="off">
        <!-- cancel  modal-->
        <div class="modal-cancel">
            <i class="fas fa-times" onclick="hideRemoveBarnAccountModal()"></i>
        </div>
        <div class="console-modal-subtext" style="font-size: small;">Barn Account</div>
        <div  class="input-frame" style="position: relative;">
            <input id="accountToRemoveBarnIdentificationInput" readonly class="projects-modal-body-item plain-input no-anime" style="width: 280px;cursor: text;font-size: small;">
        </div>
        <div class="folder-namer-buttons" style="margin-top: 5px;">
            <div onclick="removeBarnClientAccountHttpRequest()"  class="create-folder-button" style="font-size: small; background-color: rgba(53, 53, 53, 0.685);"> 
                Remove Barn
            </div>
        </div>
    </form>
</div>


<div id="client-accounts" class="client-accounts">

    <div class="top-toolbar">
        <form autocomplete="off" method="dialog">
            <input id="searchClientInput" class="top-toolbar-search" onkeyup="searchClientAccounts(this)" placeholder="Search for client" >
        </form>
        <span class="add-client-account"><i class="fas fa-plus" onclick="showAddClientModal()"></i></span>
    </div>

    <!-- categorizer -->
    <div class="clients-categorizer">
        <div class="categorizer-text ">Identification</div>
        <div class="categorizer-text hide-mobile ">Created</div>
        <div class="categorizer-text hide-mobile ">Last login</div>
        <div class="categorizer-text hide-mobile ">Access Token</div>
        <div class="categorizer-text hide-mobile">Controls</div>
    </div>


    <!-- loader -->
    <div id="clientAccountPageLoader"  class="pageLoader" style="transform: scale(0.2);">
        <div class="loader-console"></div>
   </div>

    <!-- clients items -->
    <div id="clients-accounts-list" class="clients-accounts-list">

    </div>
</div>

<script>

    let activeClientSearch = false
    
    //integration class 
    let Intergration = class {
        
        constructor(jsonObject){
            this.identifier = jsonObject["identifier"]
            this.enabled = jsonObject["enabled"]  
            this.created = ["created"]  
            this.integrationKey = ["integrationKey"] 
            this.platform = ["platform"]["name"] 
        }

    }

    //developer client class
    let DeveloperClient = class{
        constructor(developerClient){
            this.user = developerClient["user"]
            this.identification =  developerClient["identification"]
            this.date_joined =  developerClient["user"]["date_joined"]
            this.last_login =  developerClient["last_login"]
            this.token =  developerClient["token"]
            this.date_joined = convertDate(this.date_joined)
            this.last_login = convertDate(this.last_login)
            this.isBarned = developerClient["isBarned"]
            this.integration = developerClient["integration"]["identifier"]
        }
    }

    function getDeveloperClients(){
        ClientPageShowLoading()

        //body to display
        bodyToDisplay = document.getElementById("clients-accounts-list")
        bodyToDisplay.innerHTML = ""

        data = {
            "project" : localStorage.getItem("working-project")
        }

        //requests
        postToServer("/console/developer-clients", data, function(responce) {
            ClientPageCancelLoading()
            if (responce == "not found" || responce == "Does'nt seem like the JSON we need"){
                ShowWarning("Error Fetching Objects")
            }
            else {
                //array
                developerClientsArray = JSON.parse(responce)

                developerClientsArray.forEach(developerClient => {
                    var developerClientNew = new DeveloperClient(developerClient)
                    
                    //frame unbarned
                    frameUnbanned = `
                        <div class="client-item">
                            <div class="categorizer-text">${developerClientNew.identification}</div>
                            <div class="categorizer-text hide-mobile ">${developerClientNew.date_joined}</div>
                            <div class="categorizer-text hide-mobile ">${developerClientNew.last_login}</div>
                            <div class="categorizer-text hide-mobile ">${developerClientNew.token}</div>
                            <div class="categorizer-text controls-client-accounts hide-mobile">
                                    <div class="barn-client hide-mobile">
                                        <i class="fas fa-ban" onclick="showBarnAccountModal('${developerClientNew.identification}')"></i>
                                    </div>
                                    <div class="delete-client hide-mobile">
                                        <i class="fas fa-edit" onclick="showEditClientModal('${developerClientNew.identification}','${developerClientNew.integration}')"></i>          
                                    </div>
                                    <div class="edit-client hide-mobile">
                                        <i class="fas fa-trash" onclick="showDeleteAccountModal('${developerClientNew.identification}','${developerClientNew.integration}')"></i>
                                    </div>
                                </div>
                            </div>
                    `
         
                    //frame barned
                    frameBanned = `
                        <div class="client-item barned">
                            <div class="categorizer-text">${developerClientNew.identification}</div>
                            <div class="categorizer-text hide-mobile ">${developerClientNew.date_joined}</div>
                            <div class="categorizer-text hide-mobile ">${developerClientNew.last_login}</div>
                            <div class="categorizer-text hide-mobile ">${developerClientNew.token}</div>
                            <div class="categorizer-text controls-client-accounts hide-mobile">
                                    <div class="barn-client hide-mobile">
                                        <i class="fas fa-ban" onclick="showRemoveBarnModal('${developerClientNew.identification}')"></i>
                                    </div>
                                    <div class="delete-client hide-mobile">
                                        <i class="fas fa-edit" onclick="showEditClientModal('${developerClientNew.identification}','${developerClientNew.integration}')"></i>         
                                    </div>
                                    <div class="edit-client hide-mobile">
                                        <i class="fas fa-trash" onclick="showDeleteAccountModal('${developerClientNew.identification}','${developerClientNew.integration}')"></i>
                                    </div>
                                </div>
                            </div>
                    `

                    if (developerClientNew.isBarned){
                        bodyToDisplay.innerHTML += frameBanned
                    }
                    else{
                        bodyToDisplay.innerHTML += frameUnbanned
                    }
                    
                });
                
            }
        })

    }

    //delete account
    let clientAccountToDeleteIntegration = 'none'
    function showDeleteAccountModal(identification,integration){
        var modal = document.getElementById("deleteClientAccountModal")
        if (!modal.classList.contains("show")){
            modal.classList.add("show")
        }
        var identificationInput = document.getElementById("deleteClientAccountIdentification")
        identificationInput.value =  identification
        clientAccountToDeleteIntegration = integration
    }


    function hideDeleteAccountModal(){
        var modal = document.getElementById("deleteClientAccountModal")
        modal.classList.remove("show")
    }

    function deleteClientAccountHttpRequest(){
        data = {
            "integration" : clientAccountToDeleteIntegration,
            "password" : "none",
            "project" : localStorage.getItem("working-project"),
            "identification" : document.getElementById("deleteClientAccountIdentification").value
        }

        //create the account
        deleteToServer("/console/add-developer-client", data, function(responce) {
            if (responce == "200") {
                ShowSuccess("Client Account Deleted")
                hideDeleteAccountModal()
                if (!activeClientSearch){
                    getDeveloperClients()
                    return
                }
                searchClientAccounts(document.getElementById("searchClientInput"))
            } 
            else if (responce == "1704"){
                ShowWarning("Client Doesn't Exists")
            }
            else {
                ShowWarning("Error Deleting Account")
            }
        })
    }

    //edit client modal
    function showEditClientModal(identification, integrationClient){
        var modal = document.getElementById("editClientAccountModal")
        if (!modal.classList.contains("show")){
            modal.classList.add("show")
        }
        //set identification
        document.getElementById("updateClientAccountIdentifierInput").value = identification
        //set integration 
        
        document.getElementById("updateClientIntegrations").value = integrationClient
    }

    function hideEditClientModal(){
        var modal = document.getElementById("editClientAccountModal")
        modal.classList.remove("show")
    }

    function updateClientHttpRequest(){

        //check integration existance
        if (document.getElementById("updateClientIntegrations").value == ""){
            ShowWarning("No Integration Selected")
            return
        }

        //check username length 
        if (document.getElementById("updateClientAccountIdentifierInput").value.length < 6){
            ShowWarning("Identification Too Short")
            return
        }

        //check password
        if (document.getElementById("updateClientAccountPassword").value.length < 6){
            ShowWarning("Password Too Short")
            return
        }

        data = {
            "integration" : document.getElementById("updateClientIntegrations").value,
            "password" : document.getElementById("updateClientAccountPassword").value,
            "project" : localStorage.getItem("working-project"),
            "identification" : document.getElementById("updateClientAccountIdentifierInput").value
        }

        //create the account
        updateToServer("/console/add-developer-client", data, function(responce) {
            if (responce == "200") {
                ShowSuccess("Client Account Updated")
                hideEditClientModal()
                if (!activeClientSearch){
                    getDeveloperClients()
                    return
                }     
                searchClientAccounts(document.getElementById("searchClientInput"))
            } 
            else if (responce == "1704"){
                ShowWarning("Client Does'nt Exists")
            }
            else {
                ShowWarning("Error Creating Account")
            }
        })
    }

    //add client account
    function addClientAccount(){

        //check integration existance
        if (document.getElementById("addClientIntegrations").value == ""){
            ShowWarning("No Integration Selected")
            return
        }

        //check username length 
        if (document.getElementById("newClientAccountIdentification").value.length < 6){
            ShowWarning("Identification Too Short")
            return
        }

        //check password
        if (document.getElementById("newClientPasswordinput").value.length < 6){
            ShowWarning("Password Too Short")
            return
        }

        data = {
            "integration" : document.getElementById("addClientIntegrations").value,
            "password" : document.getElementById("newClientPasswordinput").value,
            "project" : localStorage.getItem("working-project"),
            "identification" : document.getElementById("newClientAccountIdentification").value
        }



        //create the account
        postToServer("/console/add-developer-client", data, function(responce) {
            if (responce == "200") {
                ShowSuccess("Client Account Created")
                hideAddClientModal()
                getDeveloperClients()
            } 
            else if (responce == "1704"){
                ShowWarning("Client Account Exists")
            }
            else {
                ShowWarning("Error Creating Account")
            }
        })

    }

    //client accounts
    function showClientAccounts(){
        //page
        var pageClientAccounts = document.getElementById("client-accounts")

        //show
        pageClientAccounts.style.display = "grid"

        //get integrations
        getIntegrations()
        getDeveloperClients()
    }

    function hideClientAccounts(){
        //page
        var pageClientAccounts = document.getElementById("client-accounts")

        //show
        pageClientAccounts.style.display = "none"
    }

    //barn client account
    function showBarnAccountModal(identifier){
        var modal = document.getElementById("barnClientAccountModal")
        if (!modal.classList.contains("show")){
            modal.classList.add("show")
        }

        var accountToBarnIdentificationSpan = document.getElementById("accountToBarnIdentificationSpan")
        accountToBarnIdentificationSpan.value = identifier
    }

    function hideBarnAccountModal(){
        var modal = document.getElementById("barnClientAccountModal")
        modal.classList.remove("show")
    }

    function barnClientAccountHttpRequest(){
        account_to_barn = {
            "identification" : document.getElementById("accountToBarnIdentificationSpan").value,
            "project" : localStorage.getItem("working-project")
        }
        postToServer("/console/barn-client-account", account_to_barn, function(responce) {
            if (responce == "500" || responce == "not found") {
                ShowWarning("Client Not Found")
            } else {
                ShowSuccess("Barn Successful")
                hideBarnAccountModal()
                if (activeClientSearch){
                    searchClientAccounts(document.getElementById("searchClientInput"))
                    return
                }
                getDeveloperClients()
            }
        })
    }

    //remove barn 
    function showRemoveBarnModal(identification){
        var modal = document.getElementById("removeBarnClientAccountModal")
        if (!modal.classList.contains("show")){
            modal.classList.add("show")
        }

        //set the identification
        document.getElementById("accountToRemoveBarnIdentificationInput").value = identification
    }

    function hideRemoveBarnAccountModal(){
        var modal = document.getElementById("removeBarnClientAccountModal")
        modal.classList.remove("show")
    }

    function removeBarnClientAccountHttpRequest(){
        account_to_remove_barn = {
            "identification" : document.getElementById("accountToRemoveBarnIdentificationInput").value,
            "project" : localStorage.getItem("working-project")
        }
        postToServer("/console/remove-barn-client-account", account_to_remove_barn, function(responce) {
            if (responce == "500" || responce == "not found") {
                ShowWarning("Client Not Found")
            } else {
                ShowSuccess("Barn Remmoved")
                hideBarnAccountModal()
                if (activeClientSearch){
                    searchClientAccounts(document.getElementById("searchClientInput"))
                    return
                }
                getDeveloperClients()
            }
        })
    }

    //loading page 
    function ClientPageShowLoading(){
        var modal = document.getElementById("clientAccountPageLoader")
        if (!modal.classList.contains("show")){
            modal.classList.add("show")
        }
    }

    function ClientPageCancelLoading(){
        var modal = document.getElementById("clientAccountPageLoader")
        modal.classList.remove("show")
    }

    //search client account 
    function searchClientAccounts(object){
        if (object.value == ""){
            activeClientSearch = false
            getDeveloperClients()
        }
        else {
            activeClientSearch =true
            //search data
            ClientPageShowLoading()

        //body to display
            bodyToDisplay = document.getElementById("clients-accounts-list")
            bodyToDisplay.innerHTML = ""

            data = {
                "project" : localStorage.getItem("working-project"),
                'criteria' : object.value
            }

            //requests
            postToServer("/console/search-developer-clients", data, function(responce) {
                ClientPageCancelLoading()
           
                //array
                developerClientsArray = JSON.parse(responce)

                developerClientsArray.forEach(developerClient => {
                    var developerClientNew = new DeveloperClient(developerClient)
                    
                     //frame unbarned
                    frameUnbanned = `
                        <div class="client-item">
                            <div class="categorizer-text">${developerClientNew.identification}</div>
                            <div class="categorizer-text hide-mobile ">${developerClientNew.date_joined}</div>
                            <div class="categorizer-text hide-mobile ">${developerClientNew.last_login}</div>
                            <div class="categorizer-text hide-mobile ">${developerClientNew.token}</div>
                            <div class="categorizer-text controls-client-accounts hide-mobile">
                                    <div class="barn-client hide-mobile">
                                        <i class="fas fa-ban" onclick="showBarnAccountModal('${developerClientNew.identification}')"></i>
                                    </div>
                                    <div class="delete-client hide-mobile">
                                        <i class="fas fa-edit" onclick="showEditClientModal('${developerClientNew.identification}','${developerClientNew.integration}')"></i>          
                                    </div>
                                    <div class="edit-client hide-mobile">
                                        <i class="fas fa-trash" onclick="showDeleteAccountModal('${developerClientNew.identification}','${developerClientNew.integration}')"></i>
                                    </div>
                                </div>
                            </div>
                    `
         
                    //frame barned
                    frameBanned = `
                        <div class="client-item barned">
                            <div class="categorizer-text">${developerClientNew.identification}</div>
                            <div class="categorizer-text hide-mobile ">${developerClientNew.date_joined}</div>
                            <div class="categorizer-text hide-mobile ">${developerClientNew.last_login}</div>
                            <div class="categorizer-text hide-mobile ">${developerClientNew.token}</div>
                            <div class="categorizer-text controls-client-accounts hide-mobile">
                                    <div class="barn-client hide-mobile">
                                        <i class="fas fa-ban" onclick="showRemoveBarnModal('${developerClientNew.identification}')"></i>
                                    </div>
                                    <div class="delete-client hide-mobile">
                                        <i class="fas fa-edit" onclick="showEditClientModal('${developerClientNew.identification}','${developerClientNew.integration}')"></i>         
                                    </div>
                                    <div class="edit-client hide-mobile">
                                        <i class="fas fa-trash" onclick="showDeleteAccountModal('${developerClientNew.identification}','${developerClientNew.integration}')"></i>
                                    </div>
                                </div>
                            </div>
                    `
                    if (developerClientNew.isBarned){
                        bodyToDisplay.innerHTML += frameBanned
                    }
                    else{
                        bodyToDisplay.innerHTML += frameUnbanned
                    }
                    
                });
         
            })

        }

    }

    //add client modal
    function getIntegrations(){
        //body to display 
        var bodyToDisplay = document.getElementById("addClientIntegrations")
        bodyToDisplay.innerHTML = ""

        //data 
        data = {
            "project" : localStorage.getItem("working-project") 
        }

        //request
        postToServer("/console/integrations", data, function(responce) {
            if (responce == "not found" || responce == "Does'nt seem like the JSON we need"){
                ShowWarning("Error Fetching Objects")
            }
            else{
                //array
                IntegrationObjectList = JSON.parse(responce)

                IntegrationObjectList.forEach(jsonObject => {
                    intergration = new Intergration(jsonObject)
                    frame = `
                        <option value="${intergration.identifier}">${intergration.identifier}</option>
                    `
                    bodyToDisplay.innerHTML += frame ;
                });

            }
        })

    }

    function showAddClientModal(){
        var modal = document.getElementById("addClientAccount")
        if (!modal.classList.contains("show")){
            modal.classList.add("show")
        }

        document.getElementById("newClientAccountIdentification").value = ""
        document.getElementById("newClientPasswordinput").value = ""

    }

    function hideAddClientModal(){
        var modal = document.getElementById("addClientAccount")
        modal.classList.remove("show")
    }

    //add integrations 
    function showAddIntegrationModal(){
        var modal = document.getElementById("addIntegrationModal")
        if (!modal.classList.contains("show")){
            modal.classList.add("show")
        }
    }


    function hideAddIntegrationsModal(){
        var modal = document.getElementById("addIntegrationModal")
        modal.classList.remove("show")
    }
</script>
