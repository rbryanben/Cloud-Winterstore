<style>
    .admin-accounts {
        display: none;
    }


    .accounts-admins-page {
        margin-right: 2%;
    }

    /* page toolbar */
    .accounts-admins-page .top-toolbar {
        margin-top: 20px;
        margin-left: 20px;
    }

    .top-toolbar {
        display: flex;
        justify-content: start;
        align-items: center;
    }

    .top-toolbar-search {
        background-color: rgba(223, 223, 223, 0.555);
        width: 600px;
        padding: 13px;
        margin-left: 20px;
        font-size: small;
        border: none;
        outline: none;
        color: gray;
        border-radius: 4px;
    }

    .add-admin-account {
        margin-left: auto;
        margin-right: 40px;
        color: gray;
    }

    /* categorizer */
    .admins-categorizer {
        margin-top: 20px;
        padding-left: 20px;
        padding-top: 10px;
        padding-bottom: 10px;
        display: grid;
        grid-template-columns: 25%  15% 15% 15%;
        border-bottom: solid 1px rgba(235, 235, 235, 0.685);
    }

    /* admins file item */
    .admin-item {
        padding-left: 20px;
        padding-top: 10px;
        padding-bottom: 10px;
        display: grid;
        grid-template-columns: 25%  15% 15% 15%;
        border-bottom: solid 1px rgba(235, 235, 235, 0.685);
        transition: all 0.1s ease;
    }

    select {
        -webkit-appearance: none;
        -moz-appearance: none;
        border: none;
        margin-right: 10px;
        background-position: 98% 50%;
        background-size: 12px;
        background-repeat: no-repeat;
    }


    .controls-admin-accounts {
        display: grid;
        padding-right: 10px;
        grid-template-columns: 30px 30px 30px;
    }

    
    @media only screen and (max-width: 600px) {
    .admins-file-item{
        grid-template-columns: 100%;
    }

    .top-toolbar-search {
        width: auto;
        margin-right: 5px;
    }
    }

    .barned > div{
        color: rgba(255, 0, 0, 0.651) !important;
    }

</style>

<div id="admin-accounts-accounts" class="admin-accounts">

    <div class="top-toolbar">
        <form autocomplete="off" method="dialog">
            <input id="searchadminInput" onkeyup="searchAdminAccount()" class="top-toolbar-search"  placeholder="Search for admin" >
        </form>
        <span class="add-admin-account"><i class="fas fa-plus" onclick="showAddAdminAccountModal()"></i></span>
    </div>

    <!-- categorizer -->
    <div class="admins-categorizer">
        <div class="categorizer-text ">Identification</div>
        <div class="categorizer-text hide-mobile ">Added</div>
        <div class="categorizer-text hide-mobile ">Last login</div>
        <div class="categorizer-text hide-mobile">Controls</div>
    </div>


    <!-- loader -->
    <div id="adminAccountPageLoader"  class="pageLoader" style="transform: scale(0.2);">
        <div class="loader-console"></div>
   </div>

    <!-- admins items -->
    <div id="admins-accounts-list" class="admins-accounts-list">
        
    </div>
</div>



<!-- delete admin account modal -->
<div id="deleteAdminAccountModal" class="console-modal">
    <form method="dialog" autocomplete="off">
        <!-- cancel  modal-->
        <div class="modal-cancel">
            <i class="fas fa-times" onclick="hideDeleteAdminModal()"></i>
        </div>
        <div class="console-modal-subtext" style="font-size: small;">Delete Account</div>
        <div  class="input-frame" style="position: relative;">
            <input id="deleteAdminAccountIdentification" readonly class="projects-modal-body-item plain-input no-anime" style="width: 280px;cursor: text;font-size: small;">
        </div>
        <div class="folder-namer-buttons" style="margin-top: 5px;">
            <div onclick="deleteAdminAccountHttpRequest()"  class="create-folder-button" style="font-size: small; background-color: rgba(228, 82, 82, 0.685);"> 
                Delete
            </div>
        </div>
    </form>
</div>

<!-- add client account modal -extends folder modal  -->
<div id="addAdminAccountModal" class="console-modal">
    <form method="dialog" autocomplete="off">
        <!-- cancel  modal-->
        <div class="modal-cancel">
            <i class="fas fa-times" onclick=" hideAddAdminAccountModal()"></i>
        </div>

        <div class="console-modal-subtext" style="font-size: small; margin-top: 20px;">Account Type</div>
        <div  class="input-frame" style="position: relative;">
            <select id="addAdminAccountType" class="projects-modal-body-item plain-input no-anime" style="width: 302px; padding-right: 5px; cursor: text; font-size: small;">
                <!-- integrations come here -->
                <option value="Administrator">Administrator</option>
            </select>
        </div>
        <!-- client identification-->
        <div class="console-modal-subtext" style="font-size: small;">Email</div>
        <div  class="input-frame" style="position: relative;">
            <input id="newAdminAccountIdentification" placeholder="Email" class="projects-modal-body-item plain-input no-anime" style="width: 280px;cursor: text;font-size: small;">
        </div>
        <div class="folder-namer-buttons" style="margin-top: 5px;">
            <div onclick="addAdminAccountHttpRequest()" class="create-folder-button" style="font-size: small;"> 
                Add Account
            </div>
        </div>
    </form>
</div>

<script>
    let adminAccountsPageInitilized =false
    let activeAdminAccountSearch = false

    let AdminAccountClass = class {
        constructor(JSONObject){
            this.identification =  JSONObject["identification"]
            this.last_login = convertDate(JSONObject["last_login"])
            this.added = convertDate(JSONObject["added"])
        }
    }

    //add admin account front 
    function showAddAdminAccountModal(){
        var modal = document.getElementById("addAdminAccountModal")
        document.getElementById('newAdminAccountIdentification').value = ""
        if (!modal.classList.contains("show")){
            modal.classList.add("show")
        }
    }

    function hideAddAdminAccountModal(){
        var modal = document.getElementById("addAdminAccountModal")
        if (modal.classList.contains("show")){
            modal.classList.remove("show")
        }
    }

    function addAdminAccountHttpRequest(){
        data = {
            "project" : localStorage.getItem("working-project"),
            "identification" : document.getElementById("newAdminAccountIdentification").value
        }

        //check length 
        if (data["identification"].length < 6){
            ShowWarning("Invalid Email")
            return
        }
        
        putToServer("/console/project-admin-clients", data, function(responce) {
            if (responce == "200") {
                ShowSuccess("Account Added")
                hideAddAdminAccountModal()
                if (!activeAdminAccountSearch){
                    getAdminAccounts()
                }
            } else {
                ShowWarning("Request Failed")
            }
        })

    }

    //show delete confirmation 
    function showDeleteAdminAccountModal(identification){
        var modal = document.getElementById("deleteAdminAccountModal")
        if (!modal.classList.contains("show")){
            modal.classList.add("show")
        }

        document.getElementById("deleteAdminAccountIdentification").value = identification
    }

    function hideDeleteAdminModal(){
        var modal = document.getElementById("deleteAdminAccountModal")
        if (modal.classList.contains("show")){
            modal.classList.remove("show")
        }
    }

    function deleteAdminAccountHttpRequest(){
        data = {
            "project" : localStorage.getItem("working-project"),
            "identification" : document.getElementById("deleteAdminAccountIdentification").value
        }

        deleteToServer("/console/project-admin-clients", data, function(responce) {
            if (responce == "200") {
                if (activeAdminAccountSearch == false){
                    hideDeleteAdminModal()
                    ShowSuccess("Deleted Account")
                    getAdminAccounts()
                }
            } else {
                ShowWarning("Delete Account Failed")
            }
        })
    }
    //page show and hide
    function showAdminAccounts(){
        //page
        var pageAdminAccounts = document.getElementById("admin-accounts-accounts")

        //show
        pageAdminAccounts.style.display = "grid"

        //initialize
        if (adminAccountsPageInitilized == false){
            adminAccountsPageInitilized = true
            initializeAdminAccountsPage()
        }
    }

    function hideAdminAccounts(){
        //page
        var pageAdminAccounts = document.getElementById("admin-accounts-accounts")

        //show
        pageAdminAccounts.style.display = "none"
    }

    function initializeAdminAccountsPage(){
        getAdminAccounts();
    }


    //get admin accounts
    function getAdminAccounts(){
        var bodyToAdd = document.getElementById("admins-accounts-list")
        bodyToAdd.innerHTML = ""
        data = {
            "project" : localStorage.getItem("working-project")
        }

        postToServer("/console/project-admin-clients", data, function(responce) {
            if (responce == "500") {
                ShowWarning("Error Fetching Objects")
            } else {  
                var receivedAdminAccounts = JSON.parse(responce)
                //iterate 
                receivedAdminAccounts.forEach(JSONObject => {
                    //add to object
                    var newAdminAccount = new AdminAccountClass(JSONObject)
                    //frame 
                    var frame = `
                        <div class="admin-item">
                            <div class="categorizer-text ">${newAdminAccount.identification}</div>
                            <div class="categorizer-text hide-mobile ">${newAdminAccount.added}</div>
                            <div class="categorizer-text hide-mobile ">${newAdminAccount.last_login}</div>
                            <div class="categorizer-text hide-mobile">
                                <!-- Bin-->
                                <div style="margin-left: 20px;">
                                    <i class="fas fa-trash" onclick="showDeleteAdminAccountModal('${newAdminAccount.identification}')"></i>  
                                </div>  
                            </div>
                        </div>
                    `

                    bodyToAdd.innerHTML += frame
                });
            }
        })

    }

    //search admin account
    function searchAdminAccount(){
        if (document.getElementById("searchadminInput").value == ""){
            getAdminAccounts()
            activeAdminAccountSearch = false
            return
        }
        activeAdminAccountSearch = true
        var bodyToAdd = document.getElementById("admins-accounts-list")
        bodyToAdd.innerHTML = ""
        data = {
            "project" : localStorage.getItem("working-project"),
            "identification" : document.getElementById("searchadminInput").value
        }

        patchToServer("/console/project-admin-clients", data, function(responce) {
            if (responce == "500") {
                ShowWarning("Error Fetching Objects")
            } else {  
                var receivedAdminAccounts = JSON.parse(responce)
                //iterate 
                receivedAdminAccounts.forEach(JSONObject => {
                    //add to object
                    var newAdminAccount = new AdminAccountClass(JSONObject)
                    //frame 
                    var frame = `
                        <div class="admin-item">
                            <div class="categorizer-text ">${newAdminAccount.identification}</div>
                            <div class="categorizer-text hide-mobile ">${newAdminAccount.added}</div>
                            <div class="categorizer-text hide-mobile ">${newAdminAccount.last_login}</div>
                            <div class="categorizer-text hide-mobile">
                                <!-- Bin-->
                                <div style="margin-left: 20px;">
                                    <i class="fas fa-trash" onclick="showDeleteAdminAccountModal('${newAdminAccount.identification}')"></i>  
                                </div>  
                            </div>
                        </div>
                    `

                    bodyToAdd.innerHTML += frame
                });
            }
        })
    }

</script>
