<style>
    .integrations-integrationss-page {
        display:  none;
    }


    .animate-clicked {
        transition: all 0.2s ease-in;
    }

    .animate-clicked.animate {
        transform: rotate(180deg);
    }


    /* page toolbar */
    .integrations-integrations-page.top-toolbar {
        margin-top: 20px;
        margin-left: 0px;
    }

    .top-toolbar-search {
        background-color: rgba(223, 223, 223, 0.555);
        width: 600px;
        padding: 13px;
        font-size: small;
        border: none;
        outline: none;
        color: gray;
        border-radius: 4px;
    }

    /* categorizer */
    .stats-integrations-categorizer {
        margin-top: 20px;
        padding-left: 20px;
        padding-top: 10px;
        padding-bottom: 10px;
        display: grid;
        grid-template-columns: 20% 10% 10% 10% 10% 10% 20%;
        border-bottom: solid 1px rgba(235, 235, 235, 0.685);
    }

    /* integrations file item */
    .stats-integrations-item {
        padding-left: 20px;
        padding-top: 10px;
        padding-bottom: 10px;
        display: grid;
        grid-template-columns: 20% 10% 10% 10% 10% 10% 20%;
        border-bottom: solid 1px rgba(235, 235, 235, 0.685);
        transition: all 0.1s ease;
    }
    /* allow select */
    .allow-select {
        -webkit-user-select: all;  /* Chrome 49+ */
        -moz-user-select: all;     /* Firefox 43+ */
        -ms-user-select: all;      /* No support yet */
        user-select: all; 
    }   


    .disk-body {
        display: flex;
        width: 120px;
        height: 10px;
        background-color: rgba(223, 223, 223, 0.555);
        border-radius: 6px;
    }

    .disk-inner {
        height: inherit;
        width: 50px;
        display: flex;
        background-color: rgb(61, 165, 148);
        border-radius: inherit;
    }
    .usage-caption {
        font-size: xx-small;
        padding-bottom: 2px;
    }


    @media only screen and (max-width: 600px) {
        .integrations-file-item {
            grid-template-columns: 100%
        }
    }

</style>

<div id="stats-integrations-subpage" class="integrations-integrationss-page">
    <div class="top-toolbar" >
        <form autocomplete="off" method="dialog">
            <input id="StatIntegrationsSearchInput"  autocomplete="off" onkeyup="searchIntegrationStat(this)" class="top-toolbar-search" placeholder="Search by Identification">
        </form>
        <span class="add-admin-account "><i class="fas fa-sync-alt animate-clicked" onclick="stats_integrations_page_refresh(this)"></i></span>
    </div>

    <!-- categorizer -->
    <div class="stats-integrations-categorizer">
        <div class="categorizer-text hide-mobile">Identification</div>
        <div class="categorizer-text">Status</div>
        <div class="categorizer-text hide-mobile ">Stored</div>
        <div class="categorizer-text hide-mobile ">Push</div>
        <div class="categorizer-text hide-mobile ">Pull</div>
        <div class="categorizer-text hide-mobile ">Devices</div>
        <div class="categorizer-text hide-mobile ">Daily-Average</div>
    </div>


    <!-- loader -->
    <div id="integrationsStatsLoadingModal" class="pageLoader" style="transform: scale(0.2);">
        <div class="loader-console"></div>
   </div>

    <!-- integrations items -->
    <div id="IntegrationStatsList" class="integrations-files-list" >

        <!-- item stats-->
        <div class="stats-integrations-item">
            <div class="categorizer-text hide-mobile">Cloud-Winterstore</div>
            <div class="categorizer-text">Active</div>
            <div class="categorizer-text hide-mobile ">24.5 GB</div>
            <div class="categorizer-text hide-mobile ">1880031</div>
            <div class="categorizer-text hide-mobile ">123221</div>
            <div class="categorizer-text hide-mobile ">13452</div>
            <div class="categorizer-text hide-mobile ">87232/10289 (Pull/Push)</div>
        </div>
    </div>
</div>

<script>
    let deletedIntegrationsPageInitialized = false

    //entry 
    function showStatsIntegrationsPage(){
        var page = document.getElementById("stats-integrations-subpage")
        page.style.display = "grid"

        //initialize page
        if (!deletedIntegrationsPageInitialized){
            initializeIntegrationsStats()
        }
    }

    //hide deleted integrations page
    function hideStatsIntegrationsPage(){
        var page = document.getElementById("stats-integrations-subpage")
        page.style.display = "none"
    }

    //function to initialize page
    function initializeIntegrationsStats(){
        getIntegrationsStats()
    }
    
    //function to refresh page
    function stats_integrations_page_refresh(object){
        //animate
        if (!object.classList.contains("animate")){
            object.classList.add("animate")
        }
        initializeIntegrationsStats()
    }
    //get integrations
    function getIntegrationsStats(){
        setIntegrationStatsLoader(true)
        //body to display 
        var bodyToDisplay = document.getElementById("IntegrationStatsList")
        bodyToDisplay.innerHTML = ""

        //data 
        data = {
            "project" : localStorage.getItem("working-project") 
        }

        //request
        postToServer("/console/integrations", data, function(responce) {
            setIntegrationStatsLoader(false)
            if (responce == "not found" || responce == "Does'nt seem like the JSON we need"){
                ShowWarning("Error Fetching Objects")
            }
            else{
                //array
                IntegrationObjectList = JSON.parse(responce)
                //iterate through list
                IntegrationObjectList.forEach(jsonObject => {
                    var integrationStat = new IntegrationStat(jsonObject)
                    var frame = `
                        <!-- item stats-->
                        <div class="stats-integrations-item">
                            <div class="categorizer-text hide-mobile">${integrationStat.identifier}</div>
                            <div class="categorizer-text">${integrationStat.status}</div>
                            <div class="categorizer-text hide-mobile ">${integrationStat.files_stored}</div>
                            <div class="categorizer-text hide-mobile ">${integrationStat.push}</div>
                            <div class="categorizer-text hide-mobile ">${integrationStat.pull}</div>
                            <div class="categorizer-text hide-mobile ">${integrationStat.devices}</div>
                            <div class="categorizer-text hide-mobile ">${integrationStat.daily_average}</div>
                        </div>
                    `
                    bodyToDisplay.innerHTML += frame
                });

            }
        })

    }

    //search integrations
    function searchIntegrationStat(object){
        if (object.value == ""){
            getIntegrationsStats()
            return
        }
        document.getElementById("IntegrationStatsList").innerHTML = ""
        //if search is empty
        if (object.value.length == 0){
            getIntegrationsList()
            return
        }

        //if search length is 6 or more then search 
        if (object.value.length < 6){
            return
        }

        //start loading
        setIntegrationStatsLoader(true)

        data = {
            "project" : localStorage.getItem("working-project"),
            "criteria" : object.value
        }

        postToServer("/console/search-update-integrations",data, function(responce) {
            //hide loading
            setIntegrationStatsLoader(false)
            
            //array
            IntegrationObjectList = JSON.parse(responce)
            //iterate through list
            IntegrationObjectList.forEach(jsonObject => {
                var integrationStat = new IntegrationStat(jsonObject)
                var frame = `
                    <!-- item stats-->
                    <div class="stats-integrations-item">
                        <div class="categorizer-text hide-mobile">${integrationStat.identifier}</div>
                        <div class="categorizer-text">${integrationStat.status}</div>
                        <div class="categorizer-text hide-mobile ">${integrationStat.files_stored}</div>
                        <div class="categorizer-text hide-mobile ">${integrationStat.push}</div>
                        <div class="categorizer-text hide-mobile ">${integrationStat.pull}</div>
                        <div class="categorizer-text hide-mobile ">${integrationStat.devices}</div>
                        <div class="categorizer-text hide-mobile ">${integrationStat.daily_average}</div>
                    </div>
                `

                document.getElementById("IntegrationStatsList").innerHTML += frame
            });
        })
    }

    //loading 
    function setIntegrationStatsLoader(state){
        var loadingModal = document.getElementById("integrationsStatsLoadingModal")
        if(state){
            if (!loadingModal.classList.contains("show")){
                loadingModal.classList.add("show")
            }
            return
        }
        loadingModal.classList.remove("show")
    }
    
    //integration class
    let IntegrationStat = class {
        constructor(jsonObject){
            this.identifier = jsonObject["identifier"]
            this.push = jsonObject["push"]
            this.pull = jsonObject["pull"]
            this.daily_average = jsonObject["daily_average"]
            //status
            this.status = "Disabled"
            if(jsonObject["enabled"]){
                this.status = "Enabled"
            }
            this.files_stored = jsonObject["files_stored"]
            this.devices = jsonObject["devices"]
        }
    }
</script>